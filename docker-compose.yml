# SPDX-FileCopyrightText: 2019 Free Software Foundation Europe e.V.
#
# SPDX-License-Identifier: GPL-3.0-or-later

version: '3'
services:
  reuse-api:
    image: reuse-api
    build: .
    container_name: reuse-api
    labels:
      fsfe-monitoring: "true"
    environment:
      VIRTUAL_HOST: "${VIRTUAL_HOST}"
      LETSENCRYPT_HOST: "${LETSENCRYPT_HOST}"
      LETSENCRYPT_EMAIL: "${LETSENCRYPT_EMAIL}"
      SECRET_KEY: "${SECRET_KEY}"
      SQLALCHEMY_DATABASE_PATH: "${SQLALCHEMY_DATABASE_PATH}"
      SSH_KEY_PATH: "${SSH_KEY_PATH}"
      SSH_KNOW_HOST_PATH: "${SSH_KNOW_HOST_PATH}"
      SSH_USER: "${SSH_USER}"
      REUSE_API: "${REUSE_API}"
      FORMS_URL: "${FORMS_URL}"
    volumes:
      - "${VM_VOLUME_PATH}:${CONTAINER_VOLUME_PATH}:rw"
    restart: always
    networks:
      - default
      - reuse-api-net

  connect-bridge:
    depends_on:
      - reuse-api
    image: docker:dind
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: docker network connect bridge reuse-api

networks:
  reuse-api-net:
    external: true